;*****************************************************************************************
; SNESKIT Template
;*****************************************************************************************

.include "snes.inc"

.global _nmi, main

;=========================================================================================
	.zeropage
;=========================================================================================

; Insert zeropage variables here.

;=========================================================================================
	.code
;=========================================================================================

	.a8
	.i16

;-----------------------------------------------------------------------------------------
; Program entry point
;-----------------------------------------------------------------------------------------
main:
	lda	#0Fh			; Enable screen.
	sta	REG_INIDISP		;

	lda	#0			; Mess with the palette.
:	stz	REG_CGADD		;
	sta	REG_CGDATA		;
	xba				;
	sta	REG_CGDATA		;
	xba				;
	rep	#20h			;
	ina				;
	sep	#20h			;
	bra	:-			;


;-----------------------------------------------------------------------------------------
; NMI IRQ handler
;=========================================================================================
_nmi:
;=========================================================================================
	rep	#30h			; Preserve registers (in 16-bit mode)
	pha				; 
	phx				;
	phy				;

	sep	#20h			; 8bit akku
					;
	;**********************
	;* Insert vblank code *
	;**********************

	lda	REG_TIMEUP		; Read REG_TIMEUP to reset IRQ state 
					; (otherwise the interrupt will trigger again 
					; after returning)
					;

	rep	#30h			; Restore all registers.
	ply				;
	plx				;
	pla				;

	rti				; Exit interrupt.

;=========================================================================================
	.segment "HDATA"
	.segment "HRAM"
	.segment "HRAM2"
;=========================================================================================
